{% extends "base.html" %}

{% block title %}ãƒ¡ãƒ¢ä¸€è¦§ | Flaskãƒ¡ãƒ¢ã‚¢ãƒ—ãƒª {% endblock %}

{% block content %}
  <h3>ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¢ä¸€è¦§</h3>
  {% if msg %}
    <div class="toast">
      {% if msg == "added" %}è¿½åŠ ã—ã¾ã—ãŸâœ¨{% endif %}
      {% if msg == "saved" %}ä¿å­˜ã—ã¾ã—ãŸâœ¨{% endif %}
      {% if msg == "toggled" %}æ›´æ–°ã—ã¾ã—ãŸâœ¨{% endif %}
    </div>

    <script>
      setTimeout(() => {
        const toast =document.querySelector('.toast');
        if (toast) toast.remove();
      }, 2500);
    </script>
  {% endif %}

  <!-- æ¤œç´¢ï¼†å®Œäº†ã‚’éš ã™ -->
  <form action="/" method="get" class="serch-box">
      <input type="text" name="q" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›â€¦" value="{{ serch_query }}">
      <button type="submit">ğŸ”</button>

      <label class="hide-done-label">
        <input type="checkbox" name="hide_done" value="1"
            {% if hide_done == "1" %}checked{% endif %}>
      </label>
  </form>

  <!-- ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <div class="tag-filters">
    <a href="{{ url_for('index', q=serch_query, hide_done=hide_done) }}" class="tag-btn tag-all {% if not selected_tag %}active{% endif %}">
      <span class="tag-dot"></span>
      <span class="tag-label">ã™ã¹ã¦</span>
    </a>
    <a href="{{ url_for('index', tag='é‡è¦', q=serch_query, hide_done=hide_done) }}" class="tag-btn tag-important {% if selected_tag == 'é‡è¦' %}active{% endif %}">
      <span class="tag-dot"></span>
      <span class="tag-label">é‡è¦</span>
    </a>
    <a href="{{ url_for('index', tag='ä»•äº‹', q=serch_query, hide_done=hide_done) }}" class="tag-btn tag-work {% if selected_tag == 'ä»•äº‹' %}active{% endif %}">
      <span class="tag-dot"></span>
      <span class="tag-label">ä»•äº‹</span>
    </a>
    <a href="{{ url_for('index', tag='è²·ã„ç‰©', q=serch_query, hide_done=hide_done) }}" class="tag-btn tag-shopping {% if selected_tag == 'è²·ã„ç‰©' %}active{% endif %}">
      <span class="tag-dot"></span>
      <span class="tag-label">è²·ã„ç‰©</span>
    </a>
    <a href="{{ url_for('index', tag='æ€¥ã', q=serch_query, hide_done=hide_done) }}" class="tag-btn tag-urgent {% if selected_tag == 'æ€¥ã' %}active{% endif %}">
      <span class="tag-dot"></span>
      <span class="tag-label">æ€¥ã</span>
    </a>
  </div>

  <!-- ãƒ¡ãƒ¢ä¸€è¦§ -->
  <ul class="memo-list">
    {% if memos %}
      {% for idx, memo in memos %}
        {% set is_done = "[å®Œäº†]" in memo %}
        {% set tags = [] %}
        {% if "é‡è¦" in memo %}{% set _ = tags.append(("é‡è¦","tag-important")) %}{% endif %}
        {% if "ä»•äº‹" in memo %}{% set _ = tags.append(("ä»•äº‹","tag-work")) %}{% endif %}
        {% if "è²·ã„ç‰©" in memo %}{% set _ = tags.append(("è²·ã„ç‰©","tag-shopping")) %}{% endif %}
        {% if "æ€¥ã" in memo %}{% set _ = tags.append(("ç·Šæ€¥","tag-urgent")) %}{% endif %}
        {% if "ä½" in memo %}{% set _ = tags.append(("ä½","tag-low")) %}{% endif %}

        <li class="memo-item 
            {% if is_done %}memo-done{% endif %}
            {% if msg == 'toggled' and edited == idx %}is-toggling{% endif %}
            {% if msg == 'untoggled' and edited == idx %}is-untoggling{% endif %}">

          <!-- æœ¬æ–‡å®Œäº†ã ã‘æ¶ˆã™ -->
          <span class="memo-text">
            {{ memo | replace("[å®Œäº†]", "") | trim | e }}
          </span>
          
          {% for t, cls in tags %}
            <span class="memo-tag-badge {{ cls }}">
              <span class="tag-icon"></span>
              <span class="tag-text">{{ t }}</span>
            </span>
          {% endfor %}

          <!-- å®Œäº†ãƒœã‚¿ãƒ³ -->
          <form action="{{ url_for('toggle_done', index=idx) }}" 
                method="post" style="display:inline;" class="toggle-form">
            <button type="submit" class="delete_btn">
              {% if is_done %}æˆ»ã™{% else %}å®Œäº†{% endif %}
            </button>
          </form>

          <!-- æ—¢å­˜ã®ç·¨é›†ï¼å‰Šé™¤ãƒœã‚¿ãƒ³ -->
          <a href="{{ url_for('edit_memo', index=idx) }}" class="btn btn-outline edit-link">ç·¨é›†</a>

          <form action="{{ url_for('delete_memo', index=idx) }}" method="post" style="display: inline;">
            <button type="submit" class="delete_btn">å‰Šé™¤</button>
          </form>
        </li>
      {% endfor %}
    {% else %}
      <li class="empty">ğŸ“ ã¾ã ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®ãƒ¡ãƒ¢ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</li>
    {% endif %}
  </ul>

  <!-- ãƒ¡ãƒ¢è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
  <form action="{{ url_for('add_memo') }}" method="post" class="add-memo-form">
    <input type="text" name="memo" placeholder="æ–°ã—ã„ãƒ¡ãƒ¢ã‚’å…¥åŠ›" required>

    <!-- ã‚¿ã‚°é¸æŠUI -->
    <div class="tag-select-group">
      <span class="tag-select-label">ã‚¿ã‚°ï¼š</span>

      <!-- ã‚¿ã‚°ãªã— -->
      <input type="radio" name="tag" id="tag-none" value="" class="tag-input" checked>
      <label for="tag-none" class="tag-option tag-none">
        <span class="tag-icon"></span>
        <span class="tag-text">ãªã—</span>
      </label>

      <!-- é‡è¦ -->
      <input type="radio" name="tag" id="tag-important" value="é‡è¦" class="tag-input">
      <label for="tag-important" class="tag-option tag-important">
        <span class="tag-icon"></span>
        <span class="tag-text">é‡è¦</span>
      </label>

      <!-- ä»•äº‹ -->
      <input type="radio" name="tag" id="tag-work" value="ä»•äº‹" class="tag-input">
      <label for="tag-work" class="tag-option tag-work">
        <span class="tag-icon"></span>
        <span class="tag-text">ä»•äº‹</span>
      </label>

      <!-- è²·ã„ç‰© -->
      <input type="radio" name="tag" id="tag-shopping" value="è²·ã„ç‰©" class="tag-input">
      <label for="tag-shopping" class="tag-option tag-shopping">
        <span class="tag-icon"></span>
        <span class="tag-text">è²·ã„ç‰©</span>
      </label>

      <!-- æ€¥ã -->
      <input type="radio" name="tag" id="tag-urgent" value="æ€¥ã" class="tag-input">
      <label for="tag-urgent" class="tag-option tag-urgent">
        <span class="tag-icon"></span>
        <span class="tag-text">æ€¥ã</span>
      </label>
    </div>
    
    <button type="submit" class="btn btn-primary">è¿½åŠ </button>
  </form>
  
{% endblock %}